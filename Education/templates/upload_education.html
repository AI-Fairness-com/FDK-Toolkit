<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FDK Education Fairness Audit</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #660033; /* Qatar Burgundy */
            --secondary: #FFD700; /* Harvard Gold */
            --accent: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--gradient);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .glass-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary), #4d0026);
            color: white;
            padding: 60px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--accent), #800040);
        }

        .hero-section::after {
            content: '';
            position: absolute;
            bottom: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            border-radius: 50%;
        }

        .logo {
            font-size: 3.5em;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fff, #ecf0f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .domain-title {
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 20px;
            opacity: 0.95;
        }

        .tagline {
            font-size: 1.3em;
            opacity: 0.9;
            margin-bottom: 25px;
            font-weight: 300;
        }

        .metrics-badge {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 600;
            display: inline-block;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .content-section {
            padding: 50px 40px;
        }

        .description-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 40px;
            border-radius: 20px;
            margin-bottom: 50px;
            border-left: 6px solid var(--secondary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .description-title {
            color: var(--dark);
            font-size: 1.6em;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .description-title i {
            color: var(--secondary);
            font-size: 1.2em;
        }

        .description-text {
            color: var(--gray);
            font-size: 1.1em;
            line-height: 1.7;
        }

        .upload-section {
            margin-bottom: 50px;
        }

        .upload-card {
            background: white;
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 2px dashed var(--primary);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 0, 51, 0.05), transparent);
            transition: left 0.6s ease;
        }

        .upload-card:hover::before {
            left: 100%;
        }

        .upload-card:hover {
            transform: translateY(-8px);
            border-color: var(--secondary);
            box-shadow: 0 25px 50px rgba(102, 0, 51, 0.2);
        }

        .upload-icon {
            font-size: 5em;
            color: var(--primary);
            margin-bottom: 25px;
            display: block;
            transition: all 0.3s ease;
        }

        .upload-card:hover .upload-icon {
            color: var(--secondary);
            transform: scale(1.1);
        }

        .upload-title {
            color: var(--dark);
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .upload-subtitle {
            color: var(--gray);
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 25px 0;
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: inline-block;
            padding: 18px 35px;
            background: linear-gradient(135deg, var(--primary), #4d0026);
            color: white;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 0, 51, 0.4);
            font-size: 1.1em;
        }

        .file-input-label:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(102, 0, 51, 0.6);
            background: linear-gradient(135deg, #4d0026, var(--primary));
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--secondary), #ccac00);
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 1.3em;
            font-weight: 600;
            border-radius: 35px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
            letter-spacing: 0.5px;
            margin-top: 20px;
        }

        .submit-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 35px rgba(255, 215, 0, 0.6);
            background: linear-gradient(135deg, #ccac00, var(--secondary));
        }

        .features-section {
            margin: 60px 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
        }

        .feature-card {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-top: 5px solid var(--primary);
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 25px;
            color: var(--primary);
            display: block;
            transition: all 0.3s ease;
        }

        .feature-card:hover .feature-icon {
            color: var(--secondary);
            transform: scale(1.1);
        }

        .feature-title {
            color: var(--dark);
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .feature-description {
            color: var(--gray);
            line-height: 1.6;
        }

        .legal-section {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 1px solid var(--warning);
            border-radius: 15px;
            padding: 30px;
            margin-top: 50px;
            position: relative;
            border-left: 6px solid var(--warning);
        }

        .legal-icon {
            position: absolute;
            top: -15px;
            left: 30px;
            background: white;
            padding: 10px;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            color: var(--warning);
        }

        .legal-content {
            margin-left: 50px;
        }

        .legal-title {
            color: #856404;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .legal-text {
            color: #856404;
            line-height: 1.6;
        }

        /* UNIFIED PROTOCOL: Test Type Selector - Updated per Phase 2, Step 3 */
        .test-type-selector {
            background: linear-gradient(135deg, #f0f8ff, #e6f7ff);
            border-radius: 15px;
            padding: 25px;
            margin: 30px auto;
            max-width: 600px;
            border: 2px solid #e3f2fd;
            text-align: center;
        }

        .test-type-title {
            color: var(--dark);
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .test-type-title i {
            color: var(--accent);
        }

        .test-type-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .test-type-label-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 12px 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #51748B;
            transition: all 0.3s ease;
            min-width: 220px;
        }

        .test-type-label-container.post {
            border-color: #F48120;
        }

        .test-type-label-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .test-type-label-container.active {
            background: #e8f4fc;
            border-color: #3498db;
        }

        .test-type-label-container.post.active {
            background: #fef7e8;
            border-color: #F48120;
        }

        .test-type-radio {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .test-type-label-content {
            text-align: left;
        }

        .test-type-label-main {
            font-weight: 600;
            color: #2c3e50;
        }

        .test-type-label-sub {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 4px;
        }

        /* UNIFIED PROTOCOL: Test Type Hint Box - New per Phase 2, Step 3 */
        .test-type-hint {
            margin-top: 12px;
            padding: 12px;
            background: #e8f4fc;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .test-type-hint.post {
            background: #fef7e8;
            border-left-color: #F48120;
        }

        .test-type-hint i {
            color: #3498db;
            margin-right: 8px;
        }

        .test-type-hint.post i {
            color: #F48120;
        }

        .test-type-hint-text {
            display: inline;
        }

        /* Unified System Notice */
        .unified-system-notice {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 1px solid #66bb6a;
            border-radius: 10px;
            padding: 15px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            font-size: 0.9em;
            color: #2e7d32;
            display: none;
        }

        .unified-system-notice i {
            margin-right: 8px;
        }

        /* Hide WordPress page title */
        .entry-title, .page-title, h1.entry-title, .post-title, h1 { 
            display: none !important; 
        }

        @media (max-width: 768px) {
            .glass-container {
                margin: 10px;
                border-radius: 20px;
            }
            
            .hero-section {
                padding: 40px 20px;
            }
            
            .content-section {
                padding: 30px 20px;
            }
            
            .logo {
                font-size: 2.8em;
            }
            
            .upload-card {
                padding: 30px 20px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .description-card {
                padding: 30px 20px;
            }
            
            .legal-content {
                margin-left: 0;
                margin-top: 30px;
            }
            
            .test-type-options {
                flex-direction: column;
                align-items: center;
            }
            
            .test-type-label-container {
                width: 100%;
                max-width: 300px;
            }
        }

        .file-name {
            display: block;
            margin-top: 10px;
            color: var(--success);
            font-weight: 600;
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <div class="glass-container">
        <div class="hero-section">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i> FDK™ Education
            </div>
            <div class="domain-title">Education Domain Equity Audit</div>
            <div class="tagline">Upload Education Dataset (CSV) for Educational Equity Analysis</div>
            <div class="metrics-badge">
                <i class="fas fa-chart-line"></i> 26 Education Fairness Metrics
            </div>
        </div>

        <div class="content-section">
            <div class="description-card">
                <div class="description-title">
                    <i class="fas fa-book-open"></i> Admission Decisions • Student Groups • Placement Assessments • Educational Equity
                </div>
                <div class="description-text">
                    Upload your education dataset to analyze fairness across student demographics, detect algorithmic bias in admission processes, 
                    and ensure equitable educational opportunities. Our comprehensive audit identifies disparities in access, outcomes, and resource allocation.
                </div>
            </div>

            <div class="upload-section">
                <form action="/education/education-audit" method="post" enctype="multipart/form-data" id="educationAuditForm">
                    <div class="upload-card">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-title">Upload Education Dataset</div>
                        <div class="upload-subtitle">Select a CSV file containing education data for comprehensive equity analysis</div>
                        
                        <div class="file-input-wrapper">
                            <input type="file" name="file" accept=".csv" required class="file-input" id="educationFile">
                            <label for="educationFile" class="file-input-label">
                                <i class="fas fa-file-csv"></i> Choose CSV File
                            </label>
                            <span class="file-name" id="fileName"></span>
                        </div>

                        <!-- UNIFIED PROTOCOL COMPLIANT: Test Type Selector - Phase 2, Step 3 -->
                        <div id="testTypeSelector" style="margin: 25px 0;">
                            <div style="margin-bottom: 12px; font-weight: 600; color: #2c3e50; font-size: 1.1em;">
                                <i class="fas fa-vial"></i> Fairness Test Type
                            </div>
                            
                            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                                <label class="test-type-label-container active">
                                    <input type="radio" name="test_type" value="pre_implementation" 
                                           checked class="test-type-radio">
                                    <div class="test-type-label-content">
                                        <div class="test-type-label-main">Pre-Implementation Test</div>
                                        <div class="test-type-label-sub">Baseline fairness of original algorithm</div>
                                    </div>
                                </label>
                                
                                <label class="test-type-label-container post">
                                    <input type="radio" name="test_type" value="post_implementation" 
                                           class="test-type-radio">
                                    <div class="test-type-label-content">
                                        <div class="test-type-label-main">Post-Implementation Test</div>
                                        <div class="test-type-label-sub">Fairness after bias correction</div>
                                    </div>
                                </label>
                            </div>
                            
                            <div id="testTypeHint" class="test-type-hint">
                                <i class="fas fa-info-circle"></i>
                                <span id="hintText" class="test-type-hint-text">
                                    <strong>Pre-Implementation:</strong> Test original algorithm fairness. 
                                    <strong>Post-Implementation:</strong> Test bias-corrected algorithm fairness.
                                </span>
                            </div>
                            
                            <!-- UNIFIED PROTOCOL: Hidden target column field - Phase 2, Step 3 -->
                            <input type="hidden" name="target_column" id="autoTargetColumn" value="">
                        </div>
                        
                        <button type="submit" class="submit-btn">
                            <i class="fas fa-play-circle"></i> Run Education Equity Audit
                        </button>

                        <!-- Unified System Notice -->
                        <div class="unified-system-notice" id="unifiedSystemNotice">
                            <i class="fas fa-robot"></i> FDK Intelligent Selection System: AI-powered column detection enabled
                        </div>
                    </div>
                </form>
            </div>

            <div class="features-section">
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-search-plus"></i>
                        </div>
                        <div class="feature-title">Admission Equity Analysis</div>
                        <div class="feature-description">
                            Detect bias in admission decisions, scholarship allocations, and program placements across diverse student populations.
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <div class="feature-title">Educational Compliance</div>
                        <div class="feature-description">
                            26 specialized fairness metrics aligned with educational equity standards, civil rights, and equal opportunity guidelines.
                        </div>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="feature-title">Learning Equity Analytics</div>
                        <div class="feature-description">
                            Comprehensive assessment with visual analytics, achievement gap reports, and recommendations for equitable education.
                        </div>
                    </div>
                </div>
            </div>

            <div class="legal-section">
                <div class="legal-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="legal-content">
                    <div class="legal-title">Educational Disclaimer</div>
                    <div class="legal-text">
                        This tool provides fairness assessment and analytical insights for educational data analysis and research purposes only. 
                        It supports institutional equity efforts but does not replace professional educational consultation or legal compliance review.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fileInput = document.getElementById('educationFile');
            const fileName = document.getElementById('fileName');
            const autoTargetColumn = document.getElementById('autoTargetColumn');
            const testTypeHint = document.getElementById('testTypeHint');
            const hintText = document.getElementById('hintText');
            
            const testTypeRadios = document.querySelectorAll('input[name="test_type"]');
            
            // Test type radio button handlers - per Phase 2, Step 4
            testTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateTestTypeHint(this.value);
                });
            });
            
            function updateTestTypeHint(testType) {
                const hints = {
                    'pre_implementation': 
                        '<strong>Pre-Implementation Test:</strong> Assessing baseline fairness of your original algorithm. ' +
                        'FDK will intelligently select the appropriate target column for baseline assessment.',
                    'post_implementation': 
                        '<strong>Post-Implementation Test:</strong> Evaluating fairness after bias mitigation techniques. ' +
                        'FDK will intelligently select the corrected target column for comparison.'
                };
                
                hintText.innerHTML = hints[testType] || hints['pre_implementation'];
                
                // Update hint box color based on test type - per protocol Phase 2, Step 4
                if (testType === 'post_implementation') {
                    testTypeHint.className = 'test-type-hint post';
                    testTypeHint.querySelector('i').className = 'fas fa-info-circle';
                } else {
                    testTypeHint.className = 'test-type-hint';
                    testTypeHint.querySelector('i').className = 'fas fa-info-circle';
                }
                
                // Update label container active states
                document.querySelectorAll('.test-type-label-container').forEach(container => {
                    container.classList.remove('active');
                });
                
                const activeRadio = document.querySelector(`input[name="test_type"]:checked`);
                if (activeRadio) {
                    const activeLabel = activeRadio.closest('.test-type-label-container');
                    if (activeLabel) {
                        activeLabel.classList.add('active');
                    }
                }
            }
            
            // File input handler with intelligent target detection - per Phase 2, Step 4
            fileInput.addEventListener('change', async function (e) {
                if (e.target.files.length === 0) {
                    fileName.textContent = '';
                    return;
                }

                const file = e.target.files[0];
                fileName.textContent = 'Selected: ' + file.name;
                fileName.style.color = '#27ae60';
                
                // Get selected test type - per protocol
                const selectedTestType = document.querySelector('input[name="test_type"]:checked').value;
                
                // Show loading state - per protocol
                hintText.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing dataset structure...';
                
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('test_type', selectedTestType); // UNIFIED: Add test_type parameter
                    
                    // Call enhanced API with test type - per protocol
                    const res = await fetch('/api/detect-columns', {
                        method: 'POST',
                        body: formData
                    });

                    const data = await res.json();
                    
                    if (!res.ok) {
                        throw new Error(data.error || 'Could not analyze dataset');
                    }
                    
                    // Auto-fill the hidden target column field - per protocol
                    autoTargetColumn.value = data.suggested_target;
                    
                    // Show success message with selected column - per protocol
                    hintText.innerHTML = 
                        `✅ Intelligent selection complete! ` +
                        `Target column: <strong>${data.suggested_target}</strong><br>` +
                        `<small>Based on ${selectedTestType.replace('_', ' ')} test type` +
                        (data.intelligent_selection ? ' (intelligent selection)' : '') + '</small>';
                    
                } catch (err) {
                    hintText.innerHTML = 
                        `⚠️ Could not auto-select target: ${err.message}. ` +
                        `You may need to manually specify columns.`;
                    autoTargetColumn.value = '';
                }
            });
            
            // Initialize hint - per protocol
            updateTestTypeHint('pre_implementation');
            
            // Initialize label container active states
            document.querySelectorAll('.test-type-label-container').forEach(container => {
                const radio = container.querySelector('input[type="radio"]');
                container.addEventListener('click', function() {
                    radio.checked = true;
                    updateTestTypeHint(radio.value);
                });
            });
            
            // Form submission handler
            document.getElementById('educationAuditForm').addEventListener('submit', function(e) {
                const fileInput = document.getElementById('educationFile');
                if (!fileInput.files.length) {
                    e.preventDefault();
                    showNotification('Please select a CSV file first', 'warning');
                    return;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('.submit-btn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                submitBtn.disabled = true;
                
                // Reset button after 5 seconds (in case of error)
                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 5000);
            });
        });
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            // Style notification
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#27ae60' : '#3498db'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            // Add CSS animations if not already present
            if (!document.getElementById('notification-animations')) {
                const style = document.createElement('style');
                style.id = 'notification-animations';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
    </script>
</body>
</html>